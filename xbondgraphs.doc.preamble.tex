\usepackage[utf8]{inputenc}
\usepackage{filecontents}
\usepackage{xbondgraphs}
\usepackage{xbondgraphs.iconix}
\usepackage{xspace}
\usepackage{mathpazo}
\usepackage{booktabs}
\usepackage{tabu}
\usepackage{longtable}
\usepackage{subcaption}
\usepackage{hyperref}
\usepackage{tcolorbox}
\usepackage[noabbrev]{cleveref}
%\usepackage{showframe}

\pgfmathsetlengthmacro{\multibondwidth}{32mm}
\pgfmathsetlengthmacro{\singlebondwidth}{8mm}
\pgfmathsetmacro{\barbangle}{40}

\hyphenation{bond-graphs x-bond-graphs}
\newcommand\textvtt[1]{{\normalfont\fontfamily{cmvtt}\selectfont #1}}
\renewcommand{\MacroFont}{\color{black!70!blue}\small\ttfamily}

\newcounter{todos}\setcounter{todos}{0}
\newcommand{\todolabel}{\textcolor{black}{\textbf{To do}}\xspace}
\newcommand{\todo}[1]{\stepcounter{todos}\marginpar{\raggedleft\hyperref[sec:todolist]{\todolabel (\thetodos)}}\phantomsection\addcontentsline{tdo}{subsection}{\thetodos. #1}}
\makeatletter
\newcommand{\listoftodos}{\phantomsection\section*{To-do list}\addcontentsline{toc}{section}{To-do list}\label{sec:todolist}\@starttoc{tdo}}
\makeatother

\usetikzlibrary{positioning,spy,graphs}
\tcbuselibrary{documentation}

\newcommand\Tikz{{\normalfont Ti\textit{k}Z}\xspace}
\newcommand\pgf{PGF\xspace}
\newcommand\xbondgraphs{\textsf{xbondgraphs}\xspace}
\newcommand\bondgraphs{\textsf{bondgraphs}\xspace}
\newcommand\pgfkeyspkg{\textsf{pgfkeys}\xspace}
\newcommand\amsfonts{\textsf{amsfonts}\xspace}
\let\origLaTeX\LaTeX
\def\LaTeX{\origLaTeX\xspace}
\def\cmark{\ding{51}}
\def\xmark{\ding{55}}
\newcommand{\colorpreview}[1]{\tikz{\fill[#1] (0,0) rectangle (0.55em,0.55em);}}

\captionsetup{labelfont=bf,font=small,labelsep=endash}
\captionsetup[subfigure]{font=footnotesize}

\hypersetup{
    pageanchor,
    colorlinks,
}

\tikzset{
    > = stealth,
    arrow tip demonstration/.style={red,opacity=.75},
    causal stroke demonstration/.style={blue,opacity=.75},
    arrow tip line/.style={green!40!black,line width = 0.5pt},
    mux example/.style={name=m,minimum width=20mm,fill=red,opacity=.75},
    example note/.style={font=\scriptsize\ttfamily},
}

\makeatletter
\pgfkeys{/tcb/.cd,
    doc head decoration/.style={doc@head@decoration/.style={#1}},
    doc head arrow tip/.style={doc@head@arrowtip/.style={#1}},
    doc head shape/.style={doc@head@shape/.style={#1}},
    color decoration/.store in=\kvtcb@col@decoration,
    color arrow tip/.store in=\kvtcb@col@arrowtip,
    color shape/.store in=\kvtcb@col@shape,
    before doc body decoration/.store in=\kvtcb@doc@body@decoration@before,
    after doc body decoration/.store in=\kvtcb@doc@body@decoration@after,
    before doc body arrow tip/.store in=\kvtcb@doc@body@arrowtip@before,
    after doc body arrow tip/.store in=\kvtcb@doc@body@arrowtip@after,
    before doc body shape/.store in=\kvtcb@doc@body@shape@before,
    after doc body shape/.store in=\kvtcb@doc@body@shape@after,
    /tcb/doclang/.cd,
        decoration/.store in=\kvtcb@text@decoration,
        decorations/.store in=\kvtcb@text@decorations,
        arrow tip/.store in=\kvtcb@text@arrowtip,
        arrow tips/.store in=\kvtcb@text@arrowtips,
        shape/.store in=\kvtcb@text@shape,
        shapes/.store in=\kvtcb@text@shapes,
}
\def\tcb@Print@Dec#1{\textcolor{\kvtcb@col@decoration}{\tcb@doc@bfseries\tcb@scantokens{#1}}}
\def\tcb@Print@Arr#1{\textcolor{\kvtcb@col@arrowtip}{\tcb@doc@bfseries\tcb@scantokens{#1}}}
\def\tcb@Print@Shp#1{\textcolor{\kvtcb@col@shape}{\tcb@doc@bfseries\tcb@scantokens{#1}}}
\newrobustcmd{\tcbIndexPrintDecCA}[1]{\tcb@Index@Print@CA{#1}{\kvtcb@col@decoration}{\kvtcb@text@decoration}}
\newrobustcmd{\tcbIndexPrintDecC}[1]{\tcb@Index@Print@C{#1}{\kvtcb@col@decoration}}
\newrobustcmd{\tcbIndexPrintArrCA}[1]{\tcb@Index@Print@CA{#1}{\kvtcb@col@arrowtip}{\kvtcb@text@arrowtip}}
\newrobustcmd{\tcbIndexPrintArrC}[1]{\tcb@Index@Print@C{#1}{\kvtcb@col@arrowtip}}
\newrobustcmd{\tcbIndexPrintShpCA}[1]{\tcb@Index@Print@CA{#1}{\kvtcb@col@shape}{\kvtcb@text@shape}}
\newrobustcmd{\tcbIndexPrintShpC}[1]{\tcb@Index@Print@C{#1}{\kvtcb@col@shape}}
\def\tcb@index@Dec#1{\iftcb@doc@toindex\kvtcb@index@command{#1\idx@actual\tcbIndexPrintDecCA{#1}}\kvtcb@index@command{\kvtcb@text@decorations\idx@level#1\idx@actual\tcbIndexPrintDecC{#1}}\fi}
\def\tcb@index@Arr#1{\iftcb@doc@toindex\kvtcb@index@command{#1\idx@actual\tcbIndexPrintArrCA{#1}}\kvtcb@index@command{\kvtcb@text@arrowtips\idx@level#1\idx@actual\tcbIndexPrintArrC{#1}}\fi}
\def\tcb@index@Shp#1{\iftcb@doc@toindex\kvtcb@index@command{#1\idx@actual\tcbIndexPrintShpCA{#1}}\kvtcb@index@command{\kvtcb@text@shapes\idx@level#1\idx@actual\tcbIndexPrintShpC{#1}}\fi}
\newenvironment{docDecoration}[3][]{\tcbset{#1}
    \begin{tcb@manual@entry}%
    \begin{tcb@doc@head}{doc@head@decoration,doc description={decoration}}%
    \tcb@Print@Dec{#2}\tcb@index@Dec{#2}\protected@edef\@currentlabel{#2}\label{dec:#2}{\ttfamily #3}%
    \tcb@doc@do@description%
    \end{tcb@doc@head}\nobreak\tcbset{before upper=}\kvtcb@doc@body@decoration@before\ignorespaces}%
    {\ifvmode\else\unskip\fi\kvtcb@doc@body@decoration@after\end{tcb@manual@entry}}
\newenvironment{docArrowTip}[3][]{\tcbset{#1}
    \begin{tcb@manual@entry}%
    \begin{tcb@doc@head}{doc@head@arrowtip,doc description={arrow tip}}%
    \tcb@Print@Arr{#2}\tcb@index@Arr{#2}\protected@edef\@currentlabel{#2}\label{arr:#2}{\ttfamily #3}%
    \tcb@doc@do@description%
    \end{tcb@doc@head}\nobreak\tcbset{before upper=}\kvtcb@doc@body@arrowtip@before\ignorespaces}%
    {\ifvmode\else\unskip\fi\kvtcb@doc@body@arrowtip@after\end{tcb@manual@entry}}
\newenvironment{docShape}[3][]{\tcbset{#1}
    \begin{tcb@manual@entry}%
    \begin{tcb@doc@head}{doc@head@shape,doc description={shape}}%
    \tcb@Print@Shp{#2}\tcb@index@Shp{#2}\protected@edef\@currentlabel{#2}\label{shp:#2}{\ttfamily #3}%
    \tcb@doc@do@description%
    \end{tcb@doc@head}\nobreak\tcbset{before upper=}\kvtcb@doc@body@shape@before\ignorespaces}%
    {\ifvmode\else\unskip\fi\kvtcb@doc@body@shape@after\end{tcb@manual@entry}}

\definecolor{Decoration}{RGB}{23 55 83}
\definecolor{Arrow Tip}{RGB}{158 0 89}
\definecolor{Shape}{RGB}{219 80 74}
\definecolor{Key}{RGB}{56 134 151}
\definecolor{Color}{RGB}{37 19 81}

\pgfkeys{/tcb/.cd,
    doc head/.append style={doc head decoration={#1},doc head arrow tip={#1},doc head shape={#1}},
    doc head decoration={},
    doc head arrow tip={},
    doc head shape={},
    before doc body decoration={},
    after doc body decoration={},
    before doc body arrow tip={},
    after doc body arrow tip={},
    before doc body shape={},
    after doc body shape={},
    color decoration=Decoration,
    color key=Key,
    color color=Color,
    color arrow tip=Arrow Tip,
    color shape=Shape,
}
\pgfkeys{/tcb/doclang/.cd,
    decoration=decoration,
    decorations=Decorations,
    arrow tip=arrow tip,
    arrow tips=Arrow tips,
    shape=shape,
    shapes=Shapes,
}
\def\refDec{\tcb@ref@doc{dec}}
\def\refArr{\tcb@ref@doc{arr}}
\def\refShp{\tcb@ref@doc{shp}}

\makeatother

\tcbset{
    doc left = 0em,
    doc left indent = -4em,
    doc head template/.style={boxsep=2pt,interior style={fill,left color=#1!5!white, right color = #1!25!white}},
    doc head key={doc head template={Key}},
    doc head decoration={doc head template={Decoration}},
    doc head arrow tip={doc head template={Arrow Tip}},
    doc head shape={doc head template={Shape}},
    doc head command={doc head template={Definition}},
    index colorize,
    verbatim ignore percent,
    docexample/.style={
        colframe=black!50!white,
        colback=white,
        sharp corners,
        rounded corners=northeast,
    },
    tikzdocexample/.style={
        before lower={\begin{tikzpicture}},
        after lower={\end{tikzpicture}},
    },
    keyimplementation/.style={
        doc left = 0em,
        doc head={},
    },
}

\tcbmakedocSubKey{XBGkey}{XBG}
\tcbmakedocSubKey{bondkey}{xbondgraphs/bond}
\tcbmakedocSubKey{elementkey}{xbondgraphs/element}
\tcbmakedocSubKey{muxkey}{mux}
\tcbmakedocSubKey{xbgkey}{xbg}